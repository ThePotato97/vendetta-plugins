(function(l,s,r,a,o,c,m,A){"use strict";function E(e){return s.findByProps("getGuildExperimentBucket").getGuildExperimentBucket("2023-01_voice_messages",e)}function h(){return r.before("uploadLocalFiles",s.findByProps("uploadLocalFiles"),function(e){if(!a.storage.sendAsVM)return;const n=s.findByProps("getLastSelectedGuildId").getGuildId();if(!n||E(n)==1){const t=e[0].items[0];t.mimeType.startsWith("audio")&&(e[0].flags=8192,t.waveform=t.item.waveform="AEtWPyUaGA4OEAcA",t.durationSecs=t.item.durationSecs=99999)}})}function _(){return r.before("actionHandler",o.FluxDispatcher._actionHandlers._computeOrderedActionHandlers("LOAD_MESSAGES_SUCCESS").find(function(e){return e.name==="MessageStore"}),function(e){a.storage.allAsVM&&e[0].messages.forEach(function(n){n.attachments.forEach(function(t){t.content_type?.startsWith?.("audio")&&(n.flags|=8192,t.waveform="AEtWPyUaGA4OEAcA",t.duration_secs=9999)})})})}function y(){return r.before("actionHandler",o.FluxDispatcher._actionHandlers._computeOrderedActionHandlers("MESSAGE_CREATE").find(function(e){return e.name==="MessageStore"}),function(e){if(!a.storage.allAsVM)return;let n=e[0].message;n?.attachments?.[0]?.content_type?.startsWith("audio")&&(n.flags|=8192,n.attachments.forEach(function(t){t.waveform="AEtWPyUaGA4OEAcA",t.duration_secs=9999}))})}function S(){return r.before("actionHandler",o.FluxDispatcher._actionHandlers._computeOrderedActionHandlers("MESSAGE_UPDATE").find(function(e){return e.name==="MessageStore"}),function(e){if(!a.storage.allAsVM)return;let n=e[0].message;n?.attachments?.[0]?.content_type?.startsWith("audio")&&(n.flags|=8192,n.attachments.forEach(function(t){t.waveform="AEtWPyUaGA4OEAcA",t.duration_secs=9999}))})}const v=s.findByProps("openLazy","hideActionSheet"),M=s.findByName("Icon"),{FormRow:R}=m.Forms;function w(){return r.before("openLazy",v,function(e){const[n,t,F]=e;t==="MessageLongPressActionSheet"&&n.then(function(P){const D=r.after("default",P,function(L,b){o.React.useEffect(function(){return function(){D()}},[]);let[G,g]=b.props?.children?.props?.children?.props?.children;const f=G?.props?.message??F?.message;!g||!f||f.hasFlag(8192)&&g.splice(5,0,o.React.createElement(R,{label:"Download Voice Message",leading:o.React.createElement(M,{source:c.getAssetIDByName("ic_download_24px")}),onPress:async function(){await s.findByProps("downloadMediaAsset").downloadMediaAsset(f.attachments[0].url,0),s.findByProps("hideActionSheet").hideActionSheet()}}))})})})}const{FormDivider:d,FormIcon:i,FormSwitchRow:u}=m.Forms;function V(){return A.useProxy(a.storage),React.createElement(o.ReactNative.ScrollView,null,React.createElement(u,{label:"Audio Waveform",leading:React.createElement(i,{source:c.getAssetIDByName("ic_stage_music")}),onValueChange:function(e){return a.storage.waveForm=e},value:a.storage.waveForm}),React.createElement(d,null),React.createElement(u,{label:"Audio Length",leading:React.createElement(i,{source:c.getAssetIDByName("ic_stage_music")}),onValueChange:function(e){return a.storage.audioLength=e},value:a.storage.audioLength}),React.createElement(d,null),React.createElement(u,{label:"Send audio files as Voice Message",leading:React.createElement(i,{source:c.getAssetIDByName("voice_bar_mute_off")}),onValueChange:function(e){return a.storage.sendAsVM=e},value:a.storage.sendAsVM}),React.createElement(d,null),React.createElement(u,{label:"Show every audio file as a Voice Message",leading:React.createElement(i,{source:c.getAssetIDByName("ic_stage_music")}),onValueChange:function(e){return a.storage.allAsVM=e},value:a.storage.allAsVM}))}a.storage.sendAsVM??=!0,a.storage.allAsVM??=!1;const p=[h(),y(),_(),S(),w()],B=function(){p.forEach(function(e){return e()})};return l.onUnload=B,l.settings=V,l})({},vendetta.metro,vendetta.patcher,vendetta.plugin,vendetta.metro.common,vendetta.ui.assets,vendetta.ui.components,vendetta.storage);
