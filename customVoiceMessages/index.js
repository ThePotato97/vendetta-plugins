(function(c,o,s,t,r,i,l,E){"use strict";function h(e){return o.findByProps("getGuildExperimentBucket").getGuildExperimentBucket("2023-01_voice_messages",e)}function v(){return s.before("uploadLocalFiles",o.findByProps("uploadLocalFiles"),function(e){if(!t.storage.sendAsVM)return;const a=o.findByProps("getLastSelectedGuildId").getGuildId();if(!a||h(a)==1){const n=e[0].items[0];n.mimeType.startsWith("audio")&&(e[0].flags=8192,n.waveform=t.storage.waveForm??"AEtWPyUaGA4OEAcA",n.durationSecs=t.storage.audioLength??9999)}})}function y(){return s.before("actionHandler",r.FluxDispatcher._actionHandlers._computeOrderedActionHandlers("LOAD_MESSAGES_SUCCESS").find(function(e){return e.name==="MessageStore"}),function(e){t.storage.allAsVM&&e[0].messages.forEach(function(a){a.attachments.forEach(function(n){n.content_type?.startsWith?.("audio")&&(a.flags|=8192,n.waveform=t.storage.waveForm??"AEtWPyUaGA4OEAcA",n.duration_secs=t.storage.audioLength??9999)})})})}function _(){return s.before("actionHandler",r.FluxDispatcher._actionHandlers._computeOrderedActionHandlers("MESSAGE_CREATE").find(function(e){return e.name==="MessageStore"}),function(e){if(!t.storage.allAsVM)return;let a=e[0].message;a?.attachments?.[0]?.content_type?.startsWith("audio")&&(a.flags|=8192,a.attachments.forEach(function(n){n.waveform=t.storage.waveForm??"AEtWPyUaGA4OEAcA",n.duration_secs=t.storage.audioLength??9999}))})}function S(){return s.before("actionHandler",r.FluxDispatcher._actionHandlers._computeOrderedActionHandlers("MESSAGE_UPDATE").find(function(e){return e.name==="MessageStore"}),function(e){if(!t.storage.allAsVM)return;let a=e[0].message;a?.attachments?.[0]?.content_type?.startsWith("audio")&&(a.flags|=8192,a.attachments.forEach(function(n){n.waveform=t.storage.waveForm??"AEtWPyUaGA4OEAcA",n.duration_secs=t.storage.audioLength??9999}))})}const M=o.findByProps("openLazy","hideActionSheet"),w=o.findByName("Icon"),{FormRow:F}=l.Forms;function R(){return s.before("openLazy",M,function(e){const[a,n,B]=e;n==="MessageLongPressActionSheet"&&a.then(function(G){const b=s.after("default",G,function(W,D){r.React.useEffect(function(){return function(){b()}},[]);let[U,g]=D.props?.children?.props?.children?.props?.children;const u=U?.props?.message??B?.message;!g||!u||u.hasFlag(8192)&&g.splice(5,0,r.React.createElement(F,{label:"Download Voice Message",leading:r.React.createElement(w,{source:i.getAssetIDByName("ic_download_24px")}),onPress:async function(){await o.findByProps("downloadMediaAsset").downloadMediaAsset(u.attachments[0].url,0),o.findByProps("hideActionSheet").hideActionSheet()}}))})})})}const{FormDivider:d,FormIcon:f,FormSwitchRow:m,FormInput:A}=l.Forms;function V(){return E.useProxy(t.storage),React.createElement(r.ReactNative.ScrollView,null,React.createElement(A,{required:!0,title:"Audio Waveform",onChangeText:function(e){return t.storage.waveForm=e},value:t.storage.waveForm||"AEtWPyUaGA4OEAcA"}),React.createElement(d,null),React.createElement(A,{required:!0,title:"Audio Length",onChangeText:function(e){return t.storage.audioLength=Number(e)},keyboardType:"numeric",value:t.storage.audioLength||60}),React.createElement(d,null),React.createElement(m,{label:"Send audio files as Voice Message",leading:React.createElement(f,{source:i.getAssetIDByName("voice_bar_mute_off")}),onValueChange:function(e){return t.storage.sendAsVM=e},value:t.storage.sendAsVM}),React.createElement(d,null),React.createElement(m,{label:"Show every audio file as a Voice Message",leading:React.createElement(f,{source:i.getAssetIDByName("ic_stage_music")}),onValueChange:function(e){return t.storage.allAsVM=e},value:t.storage.allAsVM}))}t.storage.sendAsVM??=!0,t.storage.allAsVM??=!1;const P=[v(),_(),y(),S(),R()],L=function(){P.forEach(function(e){return e()})};return c.onUnload=L,c.settings=V,c})({},vendetta.metro,vendetta.patcher,vendetta.plugin,vendetta.metro.common,vendetta.ui.assets,vendetta.ui.components,vendetta.storage);
